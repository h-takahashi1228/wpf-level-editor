<Window x:Class="MapEditTool.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:tools="clr-namespace:MapEditTool.Services.Tools"
        xmlns:views="clr-namespace:MapEditTool.Views"
        xmlns:view3d="clr-namespace:MapEditTool.View3D"
        xmlns:vm="clr-namespace:MapEditTool.ViewModels"
        xmlns:converters="clr-namespace:MapEditTool.Converters"
        mc:Ignorable="d"
        Title="MainWindow" Height="720" Width="1280">
    <Window.Resources>
        <converters:ToolEqualsConverter x:Key="ToolEqualsConverter" />
    </Window.Resources>
    <Window.InputBindings>
        <KeyBinding Key="Z" Modifiers="Ctrl" Command="{Binding UndoCommand}" />
        <KeyBinding Key="Y" Modifiers="Ctrl" Command="{Binding RedoCommand}" />
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding SaveCommand}" />
        <KeyBinding Key="O" Modifiers="Ctrl" Command="{Binding OpenCommand}" />
        <KeyBinding Key="G" Modifiers="Shift" Command="{Binding CameraResetCommand}" />
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="50"/>
            <!-- 上部ツールバー -->
            <RowDefinition Height="*"/>
            <!-- メイン -->
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <!-- 3D View -->
            <ColumnDefinition Width="220"/>
            <!-- 右UI -->
        </Grid.ColumnDefinitions>

        <Border Grid.Row="0"
            Grid.ColumnSpan="2"
            Background="#333"
            Padding="10">
            <StackPanel Orientation="Horizontal"
                VerticalAlignment="Center">

                <Button x:Name="Save"
                    Width="30"
                    Height="30"
                    Margin="0,0,5,0"
                    ToolTip="CSV形式での保存(Ctrl+S)"
                    Command="{Binding SaveCommand}">
                    <Image Source="/Images/save.png" Stretch="Uniform"/>
                </Button>
                <Button x:Name="Open"
                    Width="30"
                    Height="30"
                    Margin="0,0,5,0"
                    ToolTip="CSVから呼び出し(Ctrl+O)"
                    Command="{Binding OpenCommand}">
                    <Image Source="/Images/open.png" Stretch="Uniform"/>
                </Button>

                <Button
                    x:Name="UndoButton"
                    Width="30"
                    Height="30"
                    Margin="0,0,5,0"
                    ToolTip="元に戻す(Ctrl+Z)"
                    Command="{Binding UndoCommand}">
                    <Image Source="/Images/undo.png" Stretch="Uniform"/>
                </Button>
                <Button
                    x:Name="RedoButton"
                    Width="30"
                    Height="30"
                    Margin="0,0,5,0"
                    ToolTip="やり直し(Ctrl+Y)"
                    Command="{Binding RedoCommand}">
                    <Image Source="/Images/redo.png" Stretch="Uniform"/>
                </Button>
                <Button
                    x:Name="CameraResetButton"
                    Width="30"
                    Height="30"
                    ToolTip="カメラリセット(Shift+G)"
                    Command="{Binding CameraResetCommand}">
                    <Image Source="/Images/camera.png" Stretch="Uniform"/>
                </Button>
            </StackPanel>
        </Border>

        <Border Grid.Row="1"
            Grid.Column="0"
            Background="#22000000"
            Padding="5"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            Margin="10"
            Panel.ZIndex="1">
            <StackPanel>
                <ToggleButton Content="Create Block"
                    Width="120"
                    Margin="0,0,0,5"
                    IsChecked="{Binding CurrentTool, Converter={StaticResource ToolEqualsConverter}, ConverterParameter=PlaceBlockTool}"
                    Command="{Binding SetPlaceBlockToolCommand}" />

                <ToggleButton Content="Create Object"
                    Width="120"
                    Margin="0,0,0,5"
                    IsChecked="{Binding CurrentTool, Converter={StaticResource ToolEqualsConverter}, ConverterParameter=PlaceObjectTool}"
                    Command="{Binding SetPlaceObjectToolCommand}" />

                <ToggleButton Content="Delete"
                    Width="120"
                    Margin="0,0,0,5"
                    IsChecked="{Binding CurrentTool, Converter={StaticResource ToolEqualsConverter}, ConverterParameter=DeleteTool}"
                    Command="{Binding SetDeleteToolCommand}" />


                <ToggleButton Content="Select"
                    Width="120"
                    Margin="0,0,0,5"
                    IsChecked="{Binding CurrentTool, Converter={StaticResource ToolEqualsConverter}, ConverterParameter=SelectTool}"
                    Command="{Binding SetSelectToolCommand}" />
            </StackPanel>
        </Border>

        <!-- 左：3D View -->
        <view3d:Map3DView
            Grid.Row="1"
            Grid.Column="0"/>

        <!-- 右：UI -->
        <Border Grid.Row="1"
            Grid.Column="1"
            Background="#222"
            Padding="10">
            <ContentControl Content="{Binding CurrentTool}">
                <ContentControl.Resources>

                    <!-- ブロック生成モード -->
                    <DataTemplate DataType="{x:Type tools:PlaceBlockTool}">
                        <views:PlaceBlockPanel />
                    </DataTemplate>

                    <!-- オブジェクト生成モード -->
                    <DataTemplate DataType="{x:Type tools:PlaceObjectTool}">
                        <views:PlaceObjectPanel/>
                    </DataTemplate>

                    <!-- 削除モード -->
                    <DataTemplate DataType="{x:Type tools:DeleteTool}">
                        <views:DeletePanel />
                    </DataTemplate>

                    <!-- セレクトモード -->
                    <DataTemplate DataType="{x:Type tools:SelectTool}">
                        <ContentControl Content="{Binding UiState.SelectedTargetViewModel}" />
                    </DataTemplate>

                    <DataTemplate DataType="{x:Type vm:BlockViewModel}">
                        <views:SelectBlockPanel />
                    </DataTemplate>

                    <DataTemplate DataType="{x:Type vm:PlayerSpawnerObjectViewModel}">
                        <views:SelectObjectPanel />
                    </DataTemplate>

                    <DataTemplate DataType="{x:Type vm:EnemySpawnerObjectViewModel}">
                        <views:SelectEnemySpawnerObjectPanel />
                    </DataTemplate>
                    
                    <DataTemplate DataType="{x:Type vm:DefenseBaseObjectViewModel}">
                        <views:SelectDefenseBaseObjectPanel />
                    </DataTemplate>
                    
                    <DataTemplate DataType="{x:Type vm:EmptySelectionViewModel}">
                            <views:SelectPanel />
                    </DataTemplate>


                </ContentControl.Resources>
            </ContentControl>
        </Border>
    </Grid>
</Window>
